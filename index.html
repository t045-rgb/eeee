<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>방탈출 논리 퍼즐 게임</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117;
            color: #c9d1d9;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            text-align: center;
        }
        .container {
            width: 90%;
            max-width: 600px;
            background-color: #161b22;
            padding: 2.5rem;
            border-radius: 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid #30363d;
            position: relative; /* for hint confirmation box */
        }
        .start-screen, .game-screen, .end-screen {
            display: none;
            flex-direction: column;
            gap: 1.5rem;
        }
        .start-screen.active, .game-screen.active, .end-screen.active {
            display: flex;
        }
        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #58a6ff;
        }
        p {
            font-size: 1rem;
            line-height: 1.6;
        }
        .game-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            padding: 0.75rem 1.5rem;
            background-color: #21262d;
            border-radius: 1rem;
            border: 1px solid #30363d;
        }
        .clue-box {
            background-color: #21262d;
            border: 1px solid #30363d;
            padding: 1.5rem;
            border-radius: 1rem;
            margin-bottom: 1rem;
        }
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .input-group input {
            background-color: #0d1117;
            border: 1px solid #30363d;
            padding: 0.75rem;
            border-radius: 0.75rem;
            color: #c9d1d9;
            outline: none;
            transition: border-color 0.3s;
        }
        .input-group input:focus {
            border-color: #58a6ff;
        }
        .button {
            background-color: #238636;
            color: #fff;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
            border: none;
            font-size: 1rem;
            font-weight: 600;
        }
        .button:hover {
            background-color: #2ea043;
        }
        .button:active {
            transform: scale(0.98);
        }
        .message-box {
            background-color: #21262d;
            border: 1px solid #30363d;
            padding: 1rem;
            border-radius: 0.75rem;
            color: #c9d1d9;
            text-align: left;
            margin-top: 1rem;
        }
        .message-box.success {
            border-color: #238636;
            color: #3fb950;
        }
        .message-box.error {
            border-color: #d1212c;
            color: #f85149;
        }
        .hint-button {
            background-color: #8957e5;
            margin-top: 0.5rem;
        }
        .hint-button:hover {
            background-color: #9263e8;
        }
        .confirm-box {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #21262d;
            padding: 1.5rem;
            border-radius: 1rem;
            border: 1px solid #30363d;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.7);
            z-index: 10;
            display: none;
            flex-direction: column;
            gap: 1rem;
        }
        .confirm-box.active {
            display: flex;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Start Screen -->
        <div id="start-screen" class="start-screen active">
            <h1>방탈출 논리 퍼즐 게임</h1>
            <p>당신은 어두운 방에 갇혔습니다.<br>이 방은 논리 퍼즐로 가득 차 있습니다.<br>각 퍼즐을 풀고 단서를 모아 최종 코드를 찾아내야만 탈출할 수 있습니다.</p>
            <p>10개의 하트가 있으며, 틀릴 때마다 하나씩 사라집니다.<br>하트를 모두 잃으면 게임 오버가 됩니다.<br>타이머는 게임 시작부터 탈출까지 걸린 시간을 측정합니다.</p>
            <button id="start-button" class="button">게임 시작</button>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="game-screen">
            <div class="game-status">
                <div id="timer-display" class="text-white"></div>
                <div id="hearts-display" class="text-red-500"></div>
            </div>
            <h2 id="puzzle-title" class="text-xl font-bold mb-4"></h2>
            <div id="puzzle-clue" class="clue-box text-left"></div>
            <div class="input-group">
                <input type="text" id="user-input" placeholder="정답을 입력하세요">
                <button id="check-button" class="button">확인</button>
                <button id="hint-button" class="button hint-button">힌트 보기 (하트 3개)</button>
            </div>
            <div id="message-area" class="message-box"></div>
        </div>

        <!-- End Screen -->
        <div id="end-screen" class="end-screen">
            <h1 id="end-title"></h1>
            <p id="end-message" class="text-xl"></p>
            <button id="restart-button" class="button">다시 시작</button>
        </div>
        
        <!-- Hint Confirmation Box -->
        <div id="confirm-box" class="confirm-box">
            <p>힌트를 사용하시겠습니까? (하트 3개 차감)</p>
            <div class="flex justify-between gap-4">
                <button id="confirm-yes" class="button">확인</button>
                <button id="confirm-no" class="button">취소</button>
            </div>
        </div>
    </div>

    <script>
        const startScreen = document.getElementById('start-screen');
        const gameScreen = document.getElementById('game-screen');
        const endScreen = document.getElementById('end-screen');
        const startButton = document.getElementById('start-button');
        const checkButton = document.getElementById('check-button');
        const restartButton = document.getElementById('restart-button');
        const hintButton = document.getElementById('hint-button');
        const confirmBox = document.getElementById('confirm-box');
        const confirmYes = document.getElementById('confirm-yes');
        const confirmNo = document.getElementById('confirm-no');
        const puzzleTitle = document.getElementById('puzzle-title');
        const puzzleClue = document.getElementById('puzzle-clue');
        const userInput = document.getElementById('user-input');
        const messageArea = document.getElementById('message-area');
        const timerDisplay = document.getElementById('timer-display');
        const heartsDisplay = document.getElementById('hearts-display');
        const endTitle = document.getElementById('end-title');
        const endMessage = document.getElementById('end-message');

        const HINT_COST = 3;
        const HINT_DISPLAY_TIME = 5000; // 5초로 수정

        let currentPuzzleIndex = 0;
        let hearts = 10;
        let timeElapsed = 0;
        let timerInterval;

        // 퍼즐 데이터
        const puzzles = [
            {
                title: '첫 번째 퍼즐: 세 개의 상자',
                clue: `
                    나는 세 개의 상자를 발견했습니다. <b>파란 상자</b>, <b>빨간 상자</b>, <b>녹색 상자</b>.
                    <br>
                    파란 상자에는 "진실은 녹색 상자 안에 있다"라고 쓰여 있습니다.
                    <br>
                    빨간 상자에는 "진실은 이 상자 안에 있지 않다"라고 쓰여 있습니다.
                    <br>
                    녹색 상자에는 "진실은 이 상자 안에 있지 않다"라고 쓰여 있습니다.
                    <br>
                    <br>
                    세 개의 문장 중 <b>오직 하나만</b>이 참입니다. 진실은 어떤 상자 안에 있습니까?
                `,
                answer: '빨간 상자',
                hint: '세 개의 문장 중 하나만 참이라는 조건에 집중하세요. 문장들이 서로 어떻게 모순되는지 생각해보세요.'
            },
            {
                title: '두 번째 퍼즐: 거울 속 시계',
                clue: `
                    나는 벽에 걸린 시계를 보았습니다. 시계는 <b>거울</b>에 비춰져 있습니다.
                    <br>
                    거울 속 시계는 3시 40분을 가리키고 있습니다.
                    <br>
                    <br>
                    <b>실제 시간</b>은 몇 시 몇 분입니까?
                    <br>
                    <br>
                    답변 형식: <b>'시:분'</b>
                `,
                answer: '8:20',
                hint: '거울 속 시간은 12시를 기준으로 실제 시간과 대칭입니다.'
            },
            {
                title: '세 번째 퍼즐: 수학 문제',
                clue: `
                    칠판에 다음과 같은 방정식이 쓰여 있습니다.
                    <br>
                    <br>
                    만약 1 = 5<br>
                    2 = 25<br>
                    3 = 125<br>
                    4 = 625<br>
                    <br>
                    그렇다면 <b>5</b> = ?
                `,
                answer: '1',
                hint: '등호의 의미에 집중하세요.'
            },
            {
                title: '네 번째 퍼즐: 세 용의자의 증언',
                clue: `
                    탐정님이 살인 사건 현장에 도착했습니다. 현장에는 세 명의 용의자인 <b>지훈</b>, <b>민서</b>, 그리고 <b>태호</b>가 있습니다.
                    <br>
                    탐정님은 이 세 사람 중 <b>오직 한 명만이</b> 진실을 말하고 있다는 것을 알고 있습니다.
                    <br>
                    <br>
                    세 사람의 증언은 다음과 같습니다.
                    <br>
                    <b>지훈</b>: "민서가 범인입니다."
                    <br>
                    <b>민서</b>: "태호는 범인이 아닙니다."
                    <br>
                    <b>태호</b>: "민서가 거짓말을 하고 있습니다."
                    <br>
                    <br>
                    이 세 사람 중 누가 진실을 말하고 있나요? 그리고 진짜 범인은 누구인가요?
                    <br>
                    <br>
                    답변 형식: <b>'진실을 말하는 사람, 범인'</b>
                `,
                answer: '태호, 태호',
                hint: '용의자 세 명 중 한 명만 진실을 말합니다. 각각의 증언이 참일 경우와 거짓일 경우를 가정하여 모순이 없는 경우를 찾아보세요.'
            },
            {
                title: '최종 퍼즐: 탈출!',
                clue: `
                    이제 모든 단서를 모았습니다. 마지막 퍼즐을 풀어 탈출하세요.
                    <br>
                    <br>
                    나는 말하면 사라지고, 말하지 않으면 생긴다.
                    <br>
                    나는 누구일까?
                    <br>
                    <br>
                    답변 형식: <b>'한글'</b>
                `,
                answer: '침묵',
                hint: '이것은 소리로 만들어지지만, 소리를 내면 존재하지 않습니다.'
            }
        ];

        // 메시지를 표시하는 함수
        function showMessage(msg, type) {
            messageArea.textContent = msg;
            messageArea.classList.remove('success', 'error');
            messageArea.classList.add(type);
            setTimeout(() => {
                messageArea.textContent = '';
                messageArea.classList.remove('success', 'error');
            }, HINT_DISPLAY_TIME); // 힌트 표시 시간 변수를 사용하여 수정
        }

        // 화면 전환 함수
        function showScreen(screen) {
            startScreen.classList.remove('active');
            gameScreen.classList.remove('active');
            endScreen.classList.remove('active');
            screen.classList.add('active');
        }

        // 게임 오버 상태를 처리하는 함수
        function gameOver() {
            clearInterval(timerInterval);
            endTitle.textContent = '게임 오버';
            endMessage.textContent = '하트가 모두 사라졌습니다. 게임 오버!';
            showScreen(endScreen);
        }

        // 타이머 시작 함수
        function startTimer() {
            timerInterval = setInterval(() => {
                timeElapsed++;
                const minutes = Math.floor(timeElapsed / 60);
                const seconds = timeElapsed % 60;
                timerDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        // 하트 수 업데이트 함수
        function updateHearts() {
            heartsDisplay.textContent = '❤️'.repeat(hearts);
        }

        // 퍼즐 렌더링 함수
        function renderPuzzle() {
            if (currentPuzzleIndex >= puzzles.length) {
                clearInterval(timerInterval);
                const finalMinutes = Math.floor(timeElapsed / 60);
                const finalSeconds = timeElapsed % 60;
                endTitle.textContent = '🎉 탈출 성공 🎉';
                endMessage.textContent = `모든 퍼즐을 풀고 방을 탈출했습니다! 총 소요 시간: ${finalMinutes}분 ${finalSeconds}초`;
                showScreen(endScreen);
                return;
            }
            const puzzle = puzzles[currentPuzzleIndex];
            puzzleTitle.textContent = puzzle.title;
            puzzleClue.innerHTML = puzzle.clue;
            userInput.value = '';
            messageArea.textContent = '';
            showScreen(gameScreen);
        }

        // 시작 버튼 이벤트 리스너
        startButton.addEventListener('click', () => {
            currentPuzzleIndex = 0;
            hearts = 10;
            timeElapsed = 0;
            updateHearts();
            startTimer();
            renderPuzzle();
        });

        // 다시 시작 버튼 이벤트 리스너
        restartButton.addEventListener('click', () => {
            clearInterval(timerInterval);
            startButton.click();
        });

        // 확인 버튼 이벤트 리스너
        checkButton.addEventListener('click', () => {
            const currentPuzzle = puzzles[currentPuzzleIndex];
            const userAnswer = userInput.value.trim().toLowerCase();
            const correctAnswer = currentPuzzle.answer.toLowerCase();

            if (userAnswer === correctAnswer) {
                showMessage('정답입니다! 다음 퍼즐로 이동합니다.', 'success');
                currentPuzzleIndex++;
                setTimeout(() => {
                    renderPuzzle();
                }, 1500);
            } else {
                hearts--;
                updateHearts();
                showMessage('틀렸습니다. 하트가 하나 줄어듭니다.', 'error');
                if (hearts <= 0) {
                    gameOver();
                }
            }
        });
        
        // 힌트 버튼 이벤트 리스너
        hintButton.addEventListener('click', () => {
            if (hearts < HINT_COST) {
                showMessage('하트가 부족합니다. 힌트를 사용할 수 없습니다.', 'error');
                return;
            }
            confirmBox.classList.add('active');
        });

        // 힌트 확인 버튼 이벤트 리스너
        confirmYes.addEventListener('click', () => {
            confirmBox.classList.remove('active');
            hearts -= HINT_COST;
            updateHearts();
            const hint = puzzles[currentPuzzleIndex].hint;
            showMessage(`힌트: ${hint}`, 'info');
            if (hearts <= 0) {
                gameOver();
            }
        });

        // 힌트 취소 버튼 이벤트 리스너
        confirmNo.addEventListener('click', () => {
            confirmBox.classList.remove('active');
        });

    </script>
</body>
</html>
